/*!
 * jQuery Treefy - A Tree Plugin
 *
 * Licensed under The MIT License
 *
 * @version        0.1.0
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/treefy
 * 
 */

;(function(b){var a={init:function(c){return this.each(function(){var d=this,e=b(d);d.opt=b.extend({},b.fn.treefy.defaults,c);e.data("settings",d.opt);if(d.opt.checkbox){d.checked="treefy-"+d.opt.checkedClass;d.disabled="treefy-"+d.opt.disabledClass,d.disabledChecked="treefy-"+d.opt.disabledCheckedClass,d.partial="treefy-"+d.opt.partialClass;d.unchecked="treefy-"+d.opt.uncheckedClass;}if(d.opt.url){a.process.call(d);}else{if(d.opt.data){a.build.call(d,d.opt.data);}a.execute.call(d);}});},build:function(f){if(typeof(f)=="string"){f=b.parseJSON(f);}var d=this,c=f.tree,g='<ul class="treefy">';for(var e in c){g+=a.nextNode.call(d,c[e]);}g+="</ul>";b(d).html(g);},cascadeDown:function(g,h){var f=g.closest("li").children("ul"),e=f.length;if(e){var d=f.find(".treefy-checkbox"),c=d.children("label"),i=c.next("input");if(h.is(":checked")){c.addClass(this.checked).removeClass(this.unchecked).removeClass(this.partial);i.attr("checked","checked");}else{c.addClass(this.unchecked).removeClass(this.checked).removeClass(this.partial);i.removeAttr("checked");}}},cascadeUp:function(g){if(g.hasClass("treefy")){return;}var f=g.find('input[type="checkbox"]'),d=f.filter(":checked"),c=d.length,j=f.length==c,e=g.prev("span"),i=e.children(".treefy-checkbox").children("label"),h=i.next("input");if(j){i.addClass(this.checked).removeClass(this.partial).removeClass(this.unchecked);h.attr("checked","checked");}else{if(c>0){if(this.opt.partial){i.addClass(this.partial).removeClass(this.checked).removeClass(this.unchecked);h.removeAttr("checked");}else{i.addClass(this.checked).removeClass(this.partial).removeClass(this.unchecked);h.attr("checked","checked");}}else{i.addClass(this.unchecked).removeClass(this.partial).removeClass(this.checked);h.removeAttr("checked");}}var k=g.parent("li").closest("ul");a.cascadeUp.call(this,k);},enable:function(c){return this.each(function(){var k=b(this),f=k.closest("ul.treefy").parent(),e=f.data("settings"),i="treefy-"+e.checkedClass,g="treefy-"+e.disabledClass,j="treefy-"+e.disabledCheckedClass,h="treefy-"+e.uncheckedClass,d=k.prev("label");if(c){k.removeAttr("disabled");if(d.hasClass(g)){d.addClass(h).removeClass(g);}else{if(d.hasClass(j)){d.addClass(i).removeClass(j);}}d.css({cursor:"pointer",opacity:"1"});}else{k.attr("disabled","disabled");if(d.hasClass(i)){d.addClass(j).removeClass(i);}else{d.addClass(g).removeClass(h);}d.css({cursor:"default",opacity:".6"});}});},execute:function(){if(this.opt.checkbox){this.checkboxes=b(this).find('input[type="checkbox"]');a.styly.call(this);a.setCheckbox.call(this);}a.setFlick.call(this);a.setState.call(this);},getNode:function(e,d){var h='<span{state}><span class="treefy-'+((d=="folder")?"flick":"empty")+'"></span>';var f="";if(d!="file"){f=(e.state)?' class="treefy-'+e.state+'"':' class="treefy-closed"';}h=h.replace("{state}",f);if(e.checkbox){if(!e.checkbox.id){b.error("The 'checkbox.id' JSON element missing!");}var i=e.checkbox.checked===true||e.checkbox.checked=="checked"||e.checkbox.checked=="",c=e.checkbox.disabled===true||e.checkbox.disabled=="disabled"||e.checkbox.disabled=="";h+='<label for="'+e.checkbox.id+'"></label><input id="'+e.checkbox.id+'" type="checkbox"'+((e.checkbox.name)?' name="'+e.checkbox.name+'"':"")+((e.checkbox.value)?' value="'+e.checkbox.value+'"':"")+((i)?' checked="checked"':"")+((c)?' disabled="disabled"':"")+((e.checkbox["class"])?' class="'+e.checkbox["class"]+'"':"")+"/>";}if(this.opt.icon){h+='<span class="treefy-'+d+'"></span>';}var g=e.text||"???text???";if(e.link){h+='<a href="'+(e.link||"javascript:void(0);")+'"'+((e.target)?' target="'+e.target+'"':"")+">"+g+"</a>";}else{h+='<span class="treefy-text">'+g+"</span>";}h+="</span>";return h;},nextNode:function(f){var d=f[this.opt.childrenName],e=(d)?"folder":(f.icon||"file"),g="<li>";g+=a.getNode.call(this,f,e);if(d){if(e=="folder"){g+="<ul>";}for(var c in d){g+=a.nextNode.call(this,d[c]);}if(e=="folder"){g+="</ul>";}}g+="</li>";return g;},setCheckbox:function(){var c=this;c.checkboxes.prev("label").click(function(d){d.preventDefault();var e=b(this),f=e.next("input");if(!e.hasClass(c.disabled)&&!e.hasClass(c.disabledChecked)){if(e.hasClass(c.checked)){e.addClass(c.unchecked).removeClass(c.checked).removeClass(c.partial);f.removeAttr("checked");}else{e.addClass(c.checked).removeClass(c.unchecked).removeClass(c.partial);f.attr("checked","checked");}if(c.opt.checkDown&&e.hasClass(c.checked)||c.opt.uncheckDown&&e.hasClass(c.unchecked)){a.cascadeDown.call(c,e,f);}if(c.opt.checkUp&&e.hasClass(c.checked)||c.opt.uncheckUp&&e.hasClass(c.unchecked)){var g=e.closest("ul");a.cascadeUp.call(c,g);}}});},setFlick:function(){b(this).find(".treefy-flick").click(function(){var d=b(this).parent("span"),c=d.next("ul");if(d.hasClass("treefy-opened")){d.addClass("treefy-closed").removeClass("treefy-opened");c.hide();}else{d.addClass("treefy-opened").removeClass("treefy-closed");c.show();}});},setState:function(){var d=this,c=b(d).children("ul"),e=c.find("ul").prev("span");c.children("li:last").addClass("treefy-last");if(e.length){var f;b.each(e,function(){f=b(this);if(!f.hasClass("treefy-opened")){f.next("ul").hide();}});}if(d.opt.disableFolder){c.find('li:has("ul")').children("span").find("input").attr("disabled","disabled");}},check:function(c){return this.each(function(){var k=b(this),f=k.closest("ul.treefy").parent(),e=f.data("settings"),i="treefy-"+e.checkedClass,g="treefy-"+e.disabledClass,j="treefy-"+e.disabledCheckedClass,h="treefy-"+e.uncheckedClass,d=k.prev("label");if(!d.hasClass(g)&&!d.hasClass(j)){if(c){d.addClass(i).removeClass(h);k.attr("checked","checked");}else{d.addClass(h).removeClass(i);k.removeAttr("checked");}if(e.checkUp){f.opt=e;f.checked=i;f.unchecked=h;f.partial="treefy-"+e.partialClass;a.cascadeUp.call(f,d.closest("li").parent("ul"));}}});},styly:function(){var c=this;c.checkboxes.each(function(){var e=b(this).hide(),d=e.prev("label");if(e.is(":checked")){if(e.is(":enabled")){d.addClass(c.checked);}else{d.addClass(c.disabledChecked);d.css({cursor:"default",opacity:".6"});}}else{if(e.is(":enabled")){d.addClass(c.unchecked);}else{d.addClass(c.disabled);d.css({cursor:"default",opacity:".6"});}}b('<span class="treefy-checkbox" />').insertBefore(d).append(d,e);});},process:function(){var c=this,d={};for(var e in c.opt.params){d[e]=c.opt.params[e];}b.ajax({dataType:c.opt.dataType,jsonp:c.opt.jsonp,jsonpCallback:c.opt.jsonpCallback,type:c.opt.type,url:c.opt.url,data:d}).done(function(g,h,f){a.build.call(c,g);a.execute.call(c);if(c.opt.done){c.opt.done.call(c,g,h,f);}}).fail(function(f,h,g){if(c.opt.fail){opt.fail.call(c,f,h,g);}}).always(function(f,g){if(c.opt.always){c.opt.always.call(c,f,g);}});}};b.fn.treefy=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments);}else{b.error("Method "+c+" does not exist!");}}};b.fn.treefy.defaults={always:undefined,checkbox:false,checkDown:true,checkedClass:"checked",checkUp:true,data:undefined,dataType:"json",disabledCheckedClass:"disabled-checked",disabledClass:"disabled",disableFolder:true,done:undefined,fail:undefined,icon:true,jsonp:undefined,jsonpCallback:undefined,childrenName:"children",params:{},partial:true,partialClass:"partial",type:"get",uncheckDown:true,uncheckUp:true,uncheckedClass:"unchecked",url:undefined};})(jQuery);
